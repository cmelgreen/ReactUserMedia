{"map":{"version":3,"sources":["static/js/main.04eddf4e.chunk.js"],"names":["this","push","10","module","exports","__webpack_require__","16","__webpack_exports__","r","react","react_default","n","react_dom","react_dom_default","slicedToArray","regenerator","regenerator_default","createForOfIteratorHelper","asyncToGenerator","classCallCheck","createClass","defaultIceServers","iceServers","urls","webRTCRefactor_connHandler","connHandler","_this","Object","socket","WebSocket","window","location","hostname","peerConnection","RTCPeerConnection","listener","oniceconnectionstatechange","console","log","iceConnectionState","onnegotiationneeded","e","createOffer","then","offer","setLocalDescription","localDescription","send","key","value","sendOffer","startUserMedia","sendIceCandidates","startListener","_this2","d","conn","_startStream","a","mark","_callee","video","_iterator","_step","track","wrap","_context","prev","next","navigator","mediaDevices","getUserMedia","sent","getVideoTracks","s","done","addTrack","err","f","stop","apply","arguments","newListener","onmessage","event","message","JSON","parse","data","sdp","receiveOffer","candidate","receiveICECandidate","setRemoteDescription","RTCSessionDescription","sendAnswer","createAnswer","answer","addIceCandidate","_this3","onicecandidate","isOpen","payload","stringify","readyState","OPEN","remoteDescription","type","UserMedia","_useState","_useState2","stream","setStream","negotiate","Camera","current","srcObject","play","createElement","Fragment","ref","width","height","autoPlay","App_element","App","rootElement","document","getElementById","render"],"mappings":"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"},"code":"(this.webpackJsonpnew=this.webpackJsonpnew||[]).push([[0],{10:function(e,n,t){e.exports=t(16)},16:function(e,n,t){\"use strict\";t.r(n);var o=t(0),i=t.n(o),r=t(4),c=t.n(r),s=t(9),a=t(2),u=t.n(a),l=t(5),d=t(6),f=t(7),h=t(8);var p={iceServers:[{urls:\"stun:stun.l.google.com:19302\"}]},v=function(){function e(){var n=this;Object(f.a)(this,e),this.socket=new WebSocket(\"ws://\"+window.location.hostname+\":8050/ws\"),this.peerConnection=new RTCPeerConnection(p),this.listener=null,this.peerConnection.oniceconnectionstatechange=function(){return console.log(\"state change\",n.peerConnection.iceConnectionState)},this.peerConnection.onnegotiationneeded=function(e){return n.peerConnection.createOffer().then((function(e){console.log(\"onnegotationneeded\"),console.log(e),n.peerConnection.setLocalDescription(e)})).then((function(){console.log(n.peerConnection.localDescription),n.send(n.peerConnection.localDescription)}))}}return Object(h.a)(e,[{key:\"negotiate\",value:function(){this.sendOffer(),this.startUserMedia(this),this.sendIceCandidates(),this.startListener()}},{key:\"sendOffer\",value:function(){var e=this;this.peerConnection.createOffer().then((function(n){return e.peerConnection.setLocalDescription(n)}))}},{key:\"startUserMedia\",value:function(e){(function(){var n=Object(d.a)(u.a.mark((function n(){var t,o,i,r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(\"startUserMedia F\"),n.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:t=n.sent,o=Object(l.a)(t.getVideoTracks());try{for(o.s();!(i=o.n()).done;)r=i.value,e.peerConnection.addTrack(r,t),console.log(e,r)}catch(c){o.e(c)}finally{o.f()}case 6:case\"end\":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()}},{key:\"startListener\",value:function(){console.log(\"startListener\"),this.listener=this.newListener()}},{key:\"newListener\",value:function(){console.log(\"newListener\");var e=this;this.socket.onmessage=function(n){var t=JSON.parse(n.data);t.sdp?e.receiveOffer(t):t.candidate&&e.receiveICECandidate(t)}}},{key:\"receiveOffer\",value:function(e){console.log(\"receiveOffer\"),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),this.sendAnswer()}},{key:\"sendAnswer\",value:function(){console.log(\"sendAnswer\");var e=this;e.peerConnection.createAnswer().then((function(n){return console.log(n),e.send(n),e.peerConnection.setLocalDescription(n)}))}},{key:\"addUserMedia\",value:function(){console.log(\"addUserMedia\"),this.startUserMedia()}},{key:\"receiveICECandidate\",value:function(e){console.log(\"receiveICEcandidate: \",e),this.peerConnection.addIceCandidate(e)}},{key:\"sendIceCandidates\",value:function(){var e=this;return console.log(\"sendIceCandidate\"),this.peerConnection.onicecandidate=function(n){e.isOpen()&&null!=n.candidate&&e.send(n.candidate)}}},{key:\"send\",value:function(e){console.log(\"send: \",e),this.socket.send(JSON.stringify(e))}},{key:\"isOpen\",value:function(){return this.socket.readyState==WebSocket.OPEN}},{key:\"isOffer\",value:function(){return\"offer\"==this.peerConnection.remoteDescription.type}},{key:\"isAnswer\",value:function(){return\"answer\"==this.peerConnection.remoteDescription.type}}]),e}();function g(){var e=Object(o.useState)(null),n=Object(s.a)(e,2),t=n[0],i=n[1];return Object(o.useEffect)((function(){i(void(new v).negotiate())}),[]),t}function C(){var e=Object(o.useRef)(),n=g();return n&&e.current&&(e.current.srcObject=n,e.current.play()),i.a.createElement(i.a.Fragment,null,i.a.createElement(\"video\",{ref:e,width:\"640\",height:\"480\",autoPlay:!0}))}var k=i.a.createElement(C,null);function w(){return k}var y=document.getElementById(\"root\");c.a.render(i.a.createElement(w,null),y)}},[[10,1,2]]]);","extractedComments":[]}