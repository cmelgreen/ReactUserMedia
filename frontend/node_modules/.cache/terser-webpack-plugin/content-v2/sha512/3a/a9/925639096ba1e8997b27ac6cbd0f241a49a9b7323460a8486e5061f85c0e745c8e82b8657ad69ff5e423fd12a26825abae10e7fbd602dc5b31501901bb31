{"map":{"version":3,"sources":["static/js/main.6d4f0194.chunk.js"],"names":["this","push","10","module","exports","__webpack_require__","16","__webpack_exports__","r","react","react_default","n","react_dom","react_dom_default","slicedToArray","regenerator","regenerator_default","createForOfIteratorHelper","asyncToGenerator","classCallCheck","createClass","defaultIceServers","iceServers","urls","webRTCRefactor_connHandler","connHandler","_this","Object","socket","WebSocket","window","location","hostname","peerConnection","RTCPeerConnection","listener","conn","startUserMedia","_startStream","a","mark","_callee","video","_iterator","_step","track","wrap","_context","prev","next","navigator","mediaDevices","getUserMedia","sent","getVideoTracks","s","done","value","addTrack","console","log","err","e","f","stop","apply","arguments","oniceconnectionstatechange","iceConnectionState","key","_this2","createOffer","then","d","setLocalDescription","startListener","sendIceCandidates","newListener","onmessage","event","message","JSON","parse","data","sdp","receiveOffer","candidate","receiveICECandidate","setRemoteDescription","RTCSessionDescription","sendAnswer","createAnswer","answer","send","addIceCandidate","_this3","onicecandidate","isOpen","payload","stringify","readyState","OPEN","remoteDescription","type","UserMedia","_useState","_useState2","stream","setStream","negotiate","Camera","current","srcObject","play","createElement","Fragment","ref","width","height","autoPlay","App_element","App","rootElement","document","getElementById","render"],"mappings":"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"},"code":"(this.webpackJsonpnew=this.webpackJsonpnew||[]).push([[0],{10:function(e,n,t){e.exports=t(16)},16:function(e,n,t){\"use strict\";t.r(n);var i=t(0),r=t.n(i),o=t(4),s=t.n(o),c=t(9),a=t(2),u=t.n(a),l=t(5),d=t(6),f=t(7),h=t(8);var v={iceServers:[{urls:\"stun:stun.l.google.com:19302\"}]},p=function(){function e(){var n=this;Object(f.a)(this,e),this.socket=new WebSocket(\"ws://\"+window.location.hostname+\":8050/ws\"),this.peerConnection=new RTCPeerConnection(v),this.listener=null;var t=this;this.startUserMedia=function(){var e=Object(d.a)(u.a.mark((function e(){var n,i,r,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0});case 2:n=e.sent,i=Object(l.a)(n.getVideoTracks());try{for(i.s();!(r=i.n()).done;)o=r.value,t.peerConnection.addTrack(o,n),console.log(o)}catch(s){i.e(s)}finally{i.f()}case 5:case\"end\":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this.peerConnection.oniceconnectionstatechange=function(){return console.log(\"state change\",n.peerConnection.iceConnectionState)}}return Object(h.a)(e,[{key:\"negotiate\",value:function(){var e=this;this.peerConnection.createOffer().then((function(n){return e.peerConnection.setLocalDescription(n)})),this.startUserMedia(),this.startListener(),this.sendIceCandidates()}},{key:\"startListener\",value:function(){console.log(\"startListener\"),this.listener=this.newListener()}},{key:\"newListener\",value:function(){console.log(\"newListener\");var e=this;this.socket.onmessage=function(n){var t=JSON.parse(n.data);t.sdp?e.receiveOffer(t):t.candidate&&e.receiveICECandidate(t)}}},{key:\"receiveOffer\",value:function(e){console.log(\"receiveOffer\"),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),this.sendAnswer()}},{key:\"sendAnswer\",value:function(){console.log(\"sendAnswer\");var e=this;e.peerConnection.createAnswer().then((function(n){return console.log(n),e.send(n),e.peerConnection.setLocalDescription(n)}))}},{key:\"addUserMedia\",value:function(){console.log(\"addUserMedia\"),this.startUserMedia()}},{key:\"receiveICECandidate\",value:function(e){console.log(\"receiveICEcandidate: \",e),this.peerConnection.addIceCandidate(e)}},{key:\"sendIceCandidates\",value:function(){var e=this;return console.log(\"sendIceCandidate\"),this.peerConnection.onicecandidate=function(n){e.isOpen()&&null!=n.candidate&&e.send(n.candidate)}}},{key:\"send\",value:function(e){console.log(\"send: \",e),this.socket.send(JSON.stringify(e))}},{key:\"isOpen\",value:function(){return this.socket.readyState==WebSocket.OPEN}},{key:\"isOffer\",value:function(){return\"offer\"==this.peerConnection.remoteDescription.type}},{key:\"isAnswer\",value:function(){return\"answer\"==this.peerConnection.remoteDescription.type}}]),e}();function C(){var e=Object(i.useState)(null),n=Object(c.a)(e,2),t=n[0],r=n[1];return Object(i.useEffect)((function(){r(void(new p).negotiate())}),[]),t}function g(){var e=Object(i.useRef)(),n=C();return n&&e.current&&(e.current.srcObject=n,e.current.play()),r.a.createElement(r.a.Fragment,null,r.a.createElement(\"video\",{ref:e,width:\"640\",height:\"480\",autoPlay:!0}))}var w=r.a.createElement(g,null);function k(){return w}var y=document.getElementById(\"root\");s.a.render(r.a.createElement(k,null),y)}},[[10,1,2]]]);","extractedComments":[]}