{"map":{"version":3,"sources":["static/js/main.b01e380d.chunk.js"],"names":["this","push","10","module","exports","__webpack_require__","16","__webpack_exports__","r","react","react_default","n","react_dom","react_dom_default","slicedToArray","createForOfIteratorHelper","regenerator","regenerator_default","asyncToGenerator","classCallCheck","createClass","defaultIceServers","iceServers","urls","webRTCRefactor_connHandler","connHandler","_this","Object","socket","WebSocket","window","location","hostname","peerConnection","RTCPeerConnection","listener","oniceconnectionstatechange","console","log","iceConnectionState","onnegotiationneeded","e","_firstOffer","a","mark","_callee","wrap","_context","prev","next","OPEN","sendOffer","stop","apply","arguments","firstOffer","key","value","startUserMedia","sendIceCandidates","startListener","_this2","createOffer","then","d","setLocalDescription","send","conn","_startStream","_callee2","video","_iterator","_step","track","_context2","navigator","mediaDevices","getUserMedia","sent","getVideoTracks","s","done","addTrack","err","f","newListener","_this3","onmessage","event","message","JSON","parse","data","sdp","receiveDesc","candidate","receiveICECandidate","type","setRemoteDescription","RTCSessionDescription","sendAnswer","createAnswer","answer","addIceCandidate","_this4","onicecandidate","isOpen","payload","stringify","readyState","remoteDescription","UserMedia","_useState","_useState2","stream","setStream","negotiate","Camera","current","srcObject","play","createElement","Fragment","ref","width","height","autoPlay","App_element","App","rootElement","document","getElementById","render"],"mappings":"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"},"code":"(this.webpackJsonpnew=this.webpackJsonpnew||[]).push([[0],{10:function(e,n,t){e.exports=t(16)},16:function(e,n,t){\"use strict\";t.r(n);var o=t(0),i=t.n(o),s=t(5),r=t.n(s),c=t(9),a=t(6),u=t(1),l=t.n(u),d=t(3),f=t(7),h=t(8);var p={iceServers:[{urls:\"stun:stun.l.google.com:19302\"}]},v=function(){function e(){var n=this;Object(f.a)(this,e),this.socket=new WebSocket(\"ws://\"+window.location.hostname+\":8050/ws\"),this.peerConnection=new RTCPeerConnection(p),this.listener=null,this.peerConnection.oniceconnectionstatechange=function(){return console.log(\"state change\",n.peerConnection.iceConnectionState)},this.peerConnection.onnegotiationneeded=function(e){function n(){return(n=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(\"async firstOffer\"),e.next=3,this.socket.OPEN;case 3:console.log(\"socket OPEN\"),this.sendOffer();case 5:case\"end\":return e.stop()}}),e,this)})))).apply(this,arguments)}!function(){n.apply(this,arguments)}()}}return Object(h.a)(e,[{key:\"negotiate\",value:function(){this.sendOffer(),this.startUserMedia(this),this.sendIceCandidates(),this.startListener()}},{key:\"sendOffer\",value:function(){var e=this;console.log(\"sendOffer\"),this.peerConnection.createOffer().then((function(n){e.peerConnection.setLocalDescription(n),e.send(n)}))}},{key:\"startUserMedia\",value:function(e){(function(){var n=Object(d.a)(l.a.mark((function n(){var t,o,i,s;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(\"startUserMedia\"),n.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:t=n.sent,o=Object(a.a)(t.getVideoTracks());try{for(o.s();!(i=o.n()).done;)s=i.value,e.peerConnection.addTrack(s,t),console.log(s)}catch(r){o.e(r)}finally{o.f()}case 6:case\"end\":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()}},{key:\"startListener\",value:function(){console.log(\"startListener\"),this.listener=this.newListener()}},{key:\"newListener\",value:function(){var e=this;console.log(\"newListener\");var n=this;this.socket.onmessage=function(t){var o=JSON.parse(t.data);o.sdp?e.receiveDesc(o):o.candidate&&n.receiveICECandidate(o)}}},{key:\"receiveDesc\",value:function(e){console.log(\"receiveDesc\",e.type),console.log(e.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),\"offer\"==e.type&&this.sendAnswer()}},{key:\"sendAnswer\",value:function(){console.log(\"sendAnswer\");var e=this;e.peerConnection.createAnswer().then((function(n){return e.send(n),e.peerConnection.setLocalDescription(n)}))}},{key:\"addUserMedia\",value:function(){console.log(\"addUserMedia\"),this.startUserMedia()}},{key:\"receiveICECandidate\",value:function(e){console.log(\"receiveICEcandidate: \",e),this.peerConnection.addIceCandidate(e)}},{key:\"sendIceCandidates\",value:function(){var e=this;return console.log(\"sendIceCandidate\"),this.peerConnection.onicecandidate=function(n){e.isOpen()&&null!=n.candidate&&e.send(n.candidate)}}},{key:\"send\",value:function(e){console.log(\"send: \",e),this.socket.send(JSON.stringify(e))}},{key:\"isOpen\",value:function(){return this.socket.readyState==WebSocket.OPEN}},{key:\"isOffer\",value:function(){return\"offer\"==this.peerConnection.remoteDescription.type}},{key:\"isAnswer\",value:function(){return\"answer\"==this.peerConnection.remoteDescription.type}}]),e}();function g(){var e=Object(o.useState)(null),n=Object(c.a)(e,2),t=n[0],i=n[1];return Object(o.useEffect)((function(){i(void(new v).negotiate())}),[]),t}function y(){var e=Object(o.useRef)(),n=g();return n&&e.current&&(e.current.srcObject=n,e.current.play()),i.a.createElement(i.a.Fragment,null,i.a.createElement(\"video\",{ref:e,width:\"640\",height:\"480\",autoPlay:!0}))}var k=i.a.createElement(y,null);function C(){return k}var w=document.getElementById(\"root\");r.a.render(i.a.createElement(C,null),w)}},[[10,1,2]]]);","extractedComments":[]}