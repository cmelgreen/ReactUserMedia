{"map":{"version":3,"sources":["static/js/main.c27c8b29.chunk.js"],"names":["this","push","13","module","__webpack_exports__","__webpack_require__","r","react","react_default","n","react_dom","react_dom_default","slicedToArray","createForOfIteratorHelper","classCallCheck","createClass","defaultIceServers","iceServers","urls","webRTCRefactor_connHandler","connHandler","_this","Object","socket","WebSocket","window","location","hostname","peerConnection","RTCPeerConnection","listener","oniceconnectionstatechange","console","log","iceConnectionState","key","value","_this2","createOffer","then","d","setLocalDescription","startUserMedia","sendIceCandidates","startListener","conn","_step","video","navigator","mediaDevices","getUserMedia","_iterator","getVideoTracks","s","done","track","addTrack","sendAnswer","err","e","f","newListener","onmessage","event","message","JSON","parse","data","sdp","receiveOffer","candidate","receiveICECandidate","setRemoteDescription","RTCSessionDescription","createAnswer","answer","send","addIceCandidate","_this3","onicecandidate","isOpen","payload","stringify","readyState","OPEN","remoteDescription","type","UserMedia","_useState","_useState2","stream","setStream","negotiate","Camera","current","srcObject","play","a","createElement","Fragment","ref","width","height","autoPlay","App_element","App","rootElement","document","getElementById","render","8","exports"],"mappings":"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"},"code":"(this.webpackJsonpnew=this.webpackJsonpnew||[]).push([[0],{13:function(e,n,t){\"use strict\";t.r(n);var i=t(0),o=t.n(i),r=t(3),s=t.n(r),c=t(7),a=t(4),u=t(5),l=t(6);var d={iceServers:[{urls:\"stun:stun.l.google.com:19302\"}]},f=function(){function e(){var n=this;Object(u.a)(this,e),this.socket=new WebSocket(\"ws://\"+window.location.hostname+\":8050/ws\"),this.peerConnection=new RTCPeerConnection(d),this.listener=null,this.peerConnection.oniceconnectionstatechange=function(){return console.log(\"state change\",n.peerConnection.iceConnectionState)}}return Object(l.a)(e,[{key:\"negotiate\",value:function(){var e=this;this.peerConnection.createOffer().then((function(n){return e.peerConnection.setLocalDescription(n)})),this.startUserMedia(this),this.sendIceCandidates(),this.startListener()}},{key:\"startUserMedia\",value:function(e){!function(){console.log(\"startUserMedia F\");var n,t=navigator.mediaDevices.getUserMedia({video:!0}),i=Object(a.a)(t.getVideoTracks());try{for(i.s();!(n=i.n()).done;){var o=n.value;e.peerConnection.addTrack(o,t),console.log(e,o),e.sendAnswer()}}catch(r){i.e(r)}finally{i.f()}}()}},{key:\"startListener\",value:function(){console.log(\"startListener\"),this.listener=this.newListener()}},{key:\"newListener\",value:function(){console.log(\"newListener\");var e=this;this.socket.onmessage=function(n){var t=JSON.parse(n.data);t.sdp?e.receiveOffer(t):t.candidate&&e.receiveICECandidate(t)}}},{key:\"receiveOffer\",value:function(e){console.log(\"receiveOffer\"),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),this.sendAnswer()}},{key:\"sendAnswer\",value:function(){console.log(\"sendAnswer\");var e=this;e.peerConnection.createAnswer().then((function(n){return console.log(n),e.send(n),e.peerConnection.setLocalDescription(n)}))}},{key:\"addUserMedia\",value:function(){console.log(\"addUserMedia\"),this.startUserMedia()}},{key:\"receiveICECandidate\",value:function(e){console.log(\"receiveICEcandidate: \",e),this.peerConnection.addIceCandidate(e)}},{key:\"sendIceCandidates\",value:function(){var e=this;return console.log(\"sendIceCandidate\"),this.peerConnection.onicecandidate=function(n){e.isOpen()&&null!=n.candidate&&e.send(n.candidate)}}},{key:\"send\",value:function(e){console.log(\"send: \",e),this.socket.send(JSON.stringify(e))}},{key:\"isOpen\",value:function(){return this.socket.readyState==WebSocket.OPEN}},{key:\"isOffer\",value:function(){return\"offer\"==this.peerConnection.remoteDescription.type}},{key:\"isAnswer\",value:function(){return\"answer\"==this.peerConnection.remoteDescription.type}}]),e}();function v(){var e=Object(i.useState)(null),n=Object(c.a)(e,2),t=n[0],o=n[1];return Object(i.useEffect)((function(){o(void(new f).negotiate())}),[]),t}function h(){var e=Object(i.useRef)(),n=v();return n&&e.current&&(e.current.srcObject=n,e.current.play()),o.a.createElement(o.a.Fragment,null,o.a.createElement(\"video\",{ref:e,width:\"640\",height:\"480\",autoPlay:!0}))}var p=o.a.createElement(h,null);function g(){return p}var C=document.getElementById(\"root\");s.a.render(o.a.createElement(g,null),C)},8:function(e,n,t){e.exports=t(13)}},[[8,1,2]]]);","extractedComments":[]}