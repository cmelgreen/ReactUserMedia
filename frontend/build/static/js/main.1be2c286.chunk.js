(this.webpackJsonpnew=this.webpackJsonpnew||[]).push([[0],{10:function(e,n,t){e.exports=t(16)},16:function(e,n,t){"use strict";t.r(n);var o=t(0),i=t.n(o),s=t(4),r=t.n(s),c=t(9),a=t(2),u=t.n(a),l=t(5),d=t(6),f=t(7),v=t(8);var h={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},p=function(){function e(){var n=this;Object(f.a)(this,e),this.socket=new WebSocket("ws://"+window.location.hostname+":8050/ws"),this.peerConnection=new RTCPeerConnection(h),this.listener=null,this.peerConnection.oniceconnectionstatechange=function(){return console.log("state change",n.peerConnection.iceConnectionState)},this.socket.addEventListener("open",(function(){console.log("socket open"),n.peerConnection.onnegotiationneeded=function(e){console.log("negotiation needed"),n.send("renegotiate")}}))}return Object(v.a)(e,[{key:"negotiate",value:function(){this.startUserMedia(this),this.sendIceCandidates(),this.startListener()}},{key:"sendOffer",value:function(){var e=this;console.log("sendOffer"),this.peerConnection.createOffer().then((function(n){e.peerConnection.setLocalDescription(n),e.send(n)}))}},{key:"startUserMedia",value:function(e){(function(){var n=Object(d.a)(u.a.mark((function n(){var t,o,i,s;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("startUserMedia"),n.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:t=n.sent,o=Object(l.a)(t.getVideoTracks());try{for(o.s();!(i=o.n()).done;)s=i.value,e.peerConnection.addTrack(s,t),console.log(s)}catch(r){o.e(r)}finally{o.f()}case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()}},{key:"startListener",value:function(){console.log("startListener"),this.listener=this.newListener()}},{key:"newListener",value:function(){var e=this;console.log("newListener");var n=this;this.socket.onmessage=function(t){var o=JSON.parse(t.data);o.sdp?e.receiveDesc(o):o.candidate&&n.receiveICECandidate(o)}}},{key:"receiveDesc",value:function(e){console.log("receiveDesc",e.type),console.log(e.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),"offer"==e.type&&this.sendAnswer()}},{key:"sendAnswer",value:function(){console.log("sendAnswer");var e=this;e.peerConnection.createAnswer().then((function(n){return e.send(n),e.peerConnection.setLocalDescription(n)}))}},{key:"addUserMedia",value:function(){console.log("addUserMedia"),this.startUserMedia()}},{key:"receiveICECandidate",value:function(e){console.log("receiveICEcandidate: ",e),this.peerConnection.addIceCandidate(e)}},{key:"sendIceCandidates",value:function(){var e=this;return console.log("sendIceCandidate"),this.peerConnection.onicecandidate=function(n){e.isOpen()&&null!=n.candidate&&e.send(n.candidate)}}},{key:"send",value:function(e){console.log("send: ",e),this.socket.send(JSON.stringify(e))}},{key:"isOpen",value:function(){return this.socket.readyState==WebSocket.OPEN}},{key:"isOffer",value:function(){return"offer"==this.peerConnection.remoteDescription.type}},{key:"isAnswer",value:function(){return"answer"==this.peerConnection.remoteDescription.type}}]),e}();function g(){var e=Object(o.useState)(null),n=Object(c.a)(e,2),t=n[0],i=n[1];return Object(o.useEffect)((function(){i(void(new p).negotiate())}),[]),t}function k(){var e=Object(o.useRef)(),n=g();return n&&e.current&&(e.current.srcObject=n,e.current.play()),i.a.createElement(i.a.Fragment,null,i.a.createElement("video",{ref:e,width:"640",height:"480",autoPlay:!0}))}var C=i.a.createElement(k,null);function y(){return C}var w=document.getElementById("root");r.a.render(i.a.createElement(y,null),w)}},[[10,1,2]]]);
//# sourceMappingURL=main.1be2c286.chunk.js.map